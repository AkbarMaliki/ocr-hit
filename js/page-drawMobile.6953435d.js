"use strict";(self["webpackChunknew"]=self["webpackChunknew"]||[]).push([[988],{9927:function(t,e,s){s.r(e),s.d(e,{default:function(){return f}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.modal,expression:"modal"}],staticStyle:{position:"fixed",width:"100vw",height:"100vh",left:"0",top:"0","z-index":"1000000004",background:"black",opacity:"0.6"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.modal,expression:"modal"}],staticStyle:{position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","z-index":"1000000005","min-width":"50vw"}},[e("div",{staticClass:"rounded-lg shadow p-3 bg-white animate__animated animate__bounceIn"},[e("button",{staticClass:"btn btn-sm btn-dark float-right",attrs:{type:"button"},on:{click:function(e){t.modal=!1}}},[t._v("x")]),e("div",{staticClass:"p-3"},[e("h4",[t._v("Form Input")]),e("hr"),e("form",{attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"sm-form"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.vdata["field"],expression:"vdata['field']"}],staticClass:"form-control p-2 rounded-lg shadow",attrs:{type:"text",id:"field",name:"field",placeholder:"field"},domProps:{value:t.vdata["field"]},on:{input:function(e){e.target.composing||t.$set(t.vdata,"field",e.target.value)}}})]),e("hr"),e("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"submit"}},[t._v("Simpan")])])])])]),e("div",{staticStyle:{position:"fixed","z-index":"10000",right:"50px",top:"50%"}},[e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm",class:t.drawMode?"btn-dark":"btn-outline-dark",on:{click:t.toggleDrawMode}},[e("i",{staticClass:"fa fa-pencil-square-o",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm",class:t.eraseMode?" btn-danger ":"btn-outline-danger",on:{click:t.toggleEraseMode}},[e("i",{staticClass:"fa fa-eraser",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm btn-success",on:{click:t.saveBox}},[e("i",{staticClass:"fa fa-floppy-o",attrs:{"aria-hidden":"true"}})])])]),t._m(0),e("div",{staticClass:"row p-4"},t._l(t.listBoxes,(function(s,i){return e("div",{key:i,staticClass:"col-sm-3 text-xs p-1"},[e("div",{staticClass:"p-2 shadow rouded-sm"},[e("p",{staticClass:"m-0 p-0 font-semibold"},[t._v(" Field: "+t._s(s.field)+" ")]),e("p",{staticClass:"m-0 p-0"},[t._v(" x: "+t._s(s.x)+" ")]),e("p",{staticClass:"m-0 p-0"},[t._v(" y: "+t._s(s.y)+" ")]),e("p",{staticClass:"m-0 p-0"},[t._v(" width: "+t._s(s.width)+" ")]),e("p",{staticClass:"m-0 p-0"},[t._v(" height:"+t._s(s.height)+" ")]),e("hr"),e("button",{staticClass:"btn btn-sm btn-danger mr-2 text-xs",attrs:{type:"button"},on:{click:function(e){return t.deleteRectangle(i)}}},[t._v("Delete")])])])})),0),e("div",{staticStyle:{height:"300px"}})])},a=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"1500px",width:"100%",overflow:"scroll"},attrs:{id:"containerCanvas"}},[e("div",[e("canvas",{attrs:{id:"canvas"}})])])}],o=(s(7658),s(9199));let l=new o.Z;var r,n={data(){return{drawMode:!1,eraseMode:!1,listBoxes:[],modal:!1,imageUrl:"",move:!1,vdata:{},zoomLevel:1,item:{}}},methods:{async submitForm(){let t=this;const e=firebase.doc(firebase.firestore,"ocr-layouts",this.$route.query.id);this.listBoxes[this.listBoxes.length-1]["field"]=this.vdata.field;let s=this.listBoxes.map((t=>({x:t.x,y:t.y,width:t.width,height:t.height,field:t.field??""})));firebase.updateDoc(e,{boxes:s}).then((()=>{t.modal=!1,t.vdata={}})).catch((t=>{console.error("Error updating document:",t)}))},saveBox(t=-1){let e=this;const s=firebase.doc(firebase.firestore,"ocr-layouts",this.$route.query.id);let i=this.listBoxes.map((t=>({x:t.x,y:t.y,width:t.width,height:t.height,field:t.field??""})));firebase.updateDoc(s,{boxes:i}).then((()=>{-1!=t&&(e.listBoxes=[],e.getData("false"))})).catch((t=>{console.error("Error updating document:",t)}))},toggleDrawMode(){this.drawMode=!this.drawMode,this.eraseMode=!1},toggleEraseMode(){this.eraseMode=!this.eraseMode,this.drawMode=!1},deleteRectangle(t){const e=this.listBoxes[t];e&&(r.remove(e),this.listBoxes.splice(t,1)),this.saveBox()},async getData(t="true"){let e=this;const s=firebase.doc(firebase.firestore,"ocr-layouts",e.$route.query.id);firebase.getDoc(s).then((s=>{if(s.exists()){let i=s.data();if(e.item=i,i.boxes&&(e.listBoxes=i.boxes),e.imageUrl="https://hit-ocr.online/uploaded/"+i.filename,"true"==t)e.renderCanvas(e.imageUrl);else if("false"==t){let t=e.listBoxes.length;e.listBoxes.forEach((t=>{e.createSquare(t.x,t.y,t.width,t.height,t.field)})),e.listBoxes.splice(0,t)}}else console.log("Document does not exist")})).catch((t=>{console.error("Error getting document:",t)}))},createSquare(t,e,s,i,a){let o=this;const l=new fabric.Rect({left:t,top:e,width:s,height:i,fill:"transparent",stroke:"red",strokeWidth:2});r.add(l),r.renderAll(),l["x"]=t,l["y"]=e,l["field"]=a,o.listBoxes.push(l)},renderCanvas(t){let e=this;var s=document.getElementById("containerCanvas");r=new fabric.Canvas("canvas");var i=t;let a=e.listBoxes.length;setTimeout((()=>{e.listBoxes.forEach((t=>{e.createSquare(t.x,t.y,t.width,t.height,t.field)})),e.listBoxes.splice(0,a)}),2e3),r.on("mouse:down",(t=>{const{x:s,y:i}=t.pointer;if(this.startX=s,this.startY=i,this.eraseMode){const s=t.target;s&&"rect"===s.type&&(this.listBoxes=this.listBoxes.filter((t=>t!==s)),r.remove(s),e.saveBox(0))}}));var o=r.getObjects(),n=new fabric.Group(o);r.add(n),r.on("object:moved",(t=>{e.move=!0;const s=t.target;if(t.target._objects)l.alert("Moving multiple object is not supported for save data yet !");else if(s&&"rect"===s.type){const t=this.listBoxes.indexOf(s);this.listBoxes[t];-1!==t&&(this.listBoxes[t].x=s.left,this.listBoxes[t].y=s.top,this.saveBox(-1))}})),r.on("object:modified",(t=>{if(e.move=!0,"drag"!=t.action)if(t.target._objects)l.alert("Modified multiple object is not supported for save data yet !");else{const s=t.target;if(s&&"rect"===s.type){const t=this.listBoxes.indexOf(s);this.listBoxes[t];-1!==t&&(1!=this.listBoxes[t].scaleY&&(console.log("scaleY"),this.listBoxes[t].height=this.listBoxes[t].height*s.scaleY),1!=this.listBoxes[t].scaleX&&(console.log("scaleX"),this.listBoxes[t].width=this.listBoxes[t].width*s.scaleX),e.listBoxes.forEach((t=>{r.remove(t)})),this.saveBox(1))}}})),r.on("mouse:up",(t=>{if(this.drawMode){const{x:s,y:i}=t.pointer,a=s-this.startX,o=i-this.startY;0!=o&&(e.createSquare(this.startX,this.startY,a,o,""),e.modal=!0)}else if(e.move)e.move=!1;else{const{x:e,y:i}=t.pointer,a=e-this.startX,o=i-this.startY;s.scrollLeft=s.scrollLeft+-1*a,s.scrollTop=s.scrollTop+-1*o}})),fabric.Image.fromURL(i,(t=>{t.set({selectable:!1}),r.setBackgroundImage(t,(()=>{const e=t.width,i=t.height;r.setWidth(e),r.setHeight(i),this.canvasWidth=e,this.canvasHeight=i,s.style.height=i,r.renderAll()}))}))}},mounted(){this.getData()}},d=n,c=s(1001),h=(0,c.Z)(d,i,a,!1,null,null,null),f=h.exports}}]);
//# sourceMappingURL=page-drawMobile.6953435d.js.map