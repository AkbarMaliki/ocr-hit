"use strict";(self["webpackChunknew"]=self["webpackChunknew"]||[]).push([[988],{8043:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.modal,expression:"modal"}],staticStyle:{position:"fixed",width:"100vw",height:"100vh",left:"0",top:"0","z-index":"1000000004",background:"black",opacity:"0.6"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.modal,expression:"modal"}],staticStyle:{position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","z-index":"1000000005","min-width":"50vw"}},[e("div",{staticClass:"rounded-lg shadow p-3 bg-white animate__animated animate__bounceIn"},[e("button",{staticClass:"btn btn-sm btn-dark float-right",attrs:{type:"button"},on:{click:function(e){t.modal=!1}}},[t._v(" x ")]),e("div",{staticClass:"p-3"},[e("h4",[t._v("Form Input")]),e("hr"),e("form",{attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"sm-form"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.vdata["field"],expression:"vdata['field']"}],staticClass:"form-control p-2 rounded-lg shadow",attrs:{type:"text",id:"field",name:"field",placeholder:"field"},domProps:{value:t.vdata["field"]},on:{input:function(e){e.target.composing||t.$set(t.vdata,"field",e.target.value)}}})]),e("hr"),e("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"submit"}},[t._v("Simpan")])])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.menu,expression:"menu"}],staticStyle:{position:"fixed","z-index":"10000",right:"50px",top:"50%"}},[e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm",class:t.drawMode?"btn-dark":"btn-outline-dark",on:{click:t.toggleDrawMode}},[e("i",{staticClass:"fa fa-pencil-square-o",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm",class:t.eraseMode?" btn-danger ":"btn-outline-danger",on:{click:t.toggleEraseMode}},[e("i",{staticClass:"fa fa-eraser",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm btn-success",on:{click:t.saveBox}},[e("i",{staticClass:"fa fa-floppy-o",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm btn-info",on:{click:t.zoomIn}},[e("i",{staticClass:"fa fa-search-plus",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"mt-2"},[e("button",{staticClass:"btn btn-sm btn-info",on:{click:t.zoomOut}},[e("i",{staticClass:"fa fa-search-minus",attrs:{"aria-hidden":"true"}})])])]),t._m(0),e("div",{staticClass:"row p-4"},t._l(t.listBoxes,(function(s,i){return e("div",{key:i,staticClass:"col-sm-3 text-xs p-1"},[e("div",{staticClass:"p-2 shadow rouded-sm"},[e("p",{staticClass:"m-0 p-0 font-semibold"},[t._v("Field: "+t._s(s.field))]),e("p",{staticClass:"m-0 p-0"},[t._v("x: "+t._s(s.x))]),e("p",{staticClass:"m-0 p-0"},[t._v("y: "+t._s(s.y))]),e("p",{staticClass:"m-0 p-0"},[t._v("width: "+t._s(s.width))]),e("p",{staticClass:"m-0 p-0"},[t._v("height:"+t._s(s.height))]),e("hr"),e("button",{staticClass:"btn btn-sm btn-danger mr-2 text-xs",attrs:{type:"button"},on:{click:function(e){return t.deleteRectangle(i)}}},[t._v(" Delete ")])])])})),0),e("div",{staticStyle:{height:"300px"}})])},o=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",overflow:"scroll"},attrs:{id:"containerCanvas"}},[e("div",[e("canvas",{attrs:{id:"canvas"}})])])}],a=(s(7658),s(9199));new a.Z;var l,r={data(){return{menu:!1,drawMode:!1,eraseMode:!1,listBoxes:[],modal:!1,imageUrl:"",backgroundImg:null,move:!1,vdata:{},zoomLevel:1,zoomReverse:1,item:{}}},methods:{async submitForm(){let t=this;const e=firebase.doc(firebase.firestore,"ocr-layouts",this.$route.query.id);this.listBoxes[this.listBoxes.length-1]["field"]=this.vdata.field;let s=this.listBoxes.map((t=>({x:t.x,y:t.y,width:t.width,height:t.height,field:t.field??""})));firebase.updateDoc(e,{boxes:s}).then((()=>{t.modal=!1,t.vdata={}})).catch((t=>{console.error("Error updating document:",t)}))},saveBox(t=-1,e="false"){let s=this;const i=firebase.doc(firebase.firestore,"ocr-layouts",this.$route.query.id);let o=this.listBoxes.map((t=>({x:t.x,y:t.y,width:t.width,height:t.height,field:t.field??""})));firebase.updateDoc(i,{boxes:o}).then((()=>{-1!=t&&(s.listBoxes=[],s.getData(e))})).catch((t=>{console.error("Error updating document:",t)}))},zoomIn(){this.zoomLevel*=1.2,this.zoomReverse/=1.2,this.updateZoom()},zoomOut(){this.zoomLevel/=1.2,this.zoomReverse*=1.2,this.updateZoom()},updateZoom(){this.backgroundImg&&l.setZoom(this.zoomLevel);const t=this.zoomLevel/l.getZoom();this.listBoxes.forEach((e=>{e.left*=t,e.top*=t,e.width*=t,e.height*=t}));document.getElementById("containerCanvas");const e=document.querySelector(".upper-canvas");document.querySelector(".lower-canvas"),document.querySelector(".canvas-container");console.dir(e);this.canvasWidth,this.zoomLevel,this.canvasHeight,this.zoomLevel;l.renderAll()},toggleDrawMode(){this.drawMode=!this.drawMode,this.eraseMode=!1},toggleEraseMode(){this.eraseMode=!this.eraseMode,this.drawMode=!1},deleteRectangle(t){const e=this.listBoxes[t];e&&(l.remove(e),this.listBoxes.splice(t,1)),this.saveBox()},async getData(t="true"){let e=this;const s=firebase.doc(firebase.firestore,"ocr-layouts",e.$route.query.id);firebase.getDoc(s).then((s=>{if(s.exists()){let i=s.data();if(e.item=i,i.boxes&&(e.listBoxes=i.boxes),e.imageUrl="https://hit-ocr.online/uploaded/"+i.filename,"true"==t)e.renderCanvas(e.imageUrl);else if("false"==t){let t=e.listBoxes.length;e.listBoxes.forEach((t=>{e.createSquare(t.x,t.y,t.width,t.height,t.field)})),e.listBoxes.splice(0,t)}else if("reload"==t)if(1!=e.zoomLevel)location.reload();else{let t=e.listBoxes.length;e.listBoxes.forEach((t=>{e.createSquare(t.x,t.y,t.width,t.height,t.field)})),e.listBoxes.splice(0,t)}}else console.log("Document does not exist")})).catch((t=>{console.error("Error getting document:",t)}))},createSquare(t,e,s,i,o){let a=this;t*=this.zoomReverse,e*=this.zoomReverse,s*=this.zoomReverse,i*=this.zoomReverse;const r=new fabric.Rect({left:t,top:e,width:s,height:i,fill:"transparent",stroke:"red",strokeWidth:2});l.add(r),l.renderAll(),r["x"]=t,r["y"]=e,r["field"]=o,a.listBoxes.push(r)},renderCanvas(t){let e=this;var s=document.getElementById("containerCanvas");l=new fabric.Canvas("canvas");var i=t;let o=e.listBoxes.length;setTimeout((()=>{e.listBoxes.forEach((t=>{e.createSquare(t.x,t.y,t.width,t.height,t.field)})),e.listBoxes.splice(0,o),e.menu=!0}),2e3),l.on("mouse:down",(t=>{const{x:s,y:i}=t.pointer;if(this.startX=s,this.startY=i,this.eraseMode){const s=t.target;s&&"rect"===s.type&&(this.listBoxes=this.listBoxes.filter((t=>t!==s)),l.remove(s),e.saveBox(0))}}));var a=l.getObjects(),r=new fabric.Group(a);l.add(r),l.on("object:moved",(t=>{e.move=!0;const s=t.target;if(t.target._objects){let s=t.target._objects,i=s[0].group;s.forEach(((t,s)=>{let o=t.left,a=t.top;if(void 0==i);else{let t=i.left,l=i.top,r=o+t+i.width/2,n=a+l+i.height/2;e.listBoxes[s].x=r,e.listBoxes[s].y=n,console.log(r,n)}})),e.saveBox(-1)}else if(s&&"rect"===s.type){const t=this.listBoxes.indexOf(s);this.listBoxes[t];-1!==t&&(this.listBoxes[t].x=s.left,this.listBoxes[t].y=s.top,this.saveBox(-1))}})),l.on("object:modified",(t=>{e.move=!0;let s=t.target;if(console.log(t),"drag"!=t.action)if(s&&s._objects){let t=s._objects,i=t[0].group;if(i){let s=i.scaleX,o=i.top,a=i.left,r=i.scaleY,n=(i.left,i.width,i.top+i.height/2);console.log(o,n,r),t.forEach(((t,e)=>{this.listBoxes[e].scaleX*=s,this.listBoxes[e].scaleY*=r,this.listBoxes[e].width*=s,this.listBoxes[e].height*=r;let i=(t.left-a)*s+a;t.top;this.listBoxes[e].left=i,l.remove(this.listBoxes[e])})),e.saveBox(1,"reload")}}else{const s=t.target;if(s&&"rect"===s.type){const t=this.listBoxes.indexOf(s);this.listBoxes[t];-1!==t&&(1!=this.listBoxes[t].scaleY&&(console.log("scaleY"),this.listBoxes[t].height=this.listBoxes[t].height*s.scaleY),1!=this.listBoxes[t].scaleX&&(console.log("scaleX"),this.listBoxes[t].width=this.listBoxes[t].width*s.scaleX),e.listBoxes.forEach((t=>{l.remove(t)})),this.saveBox(1))}}})),l.on("mouse:up",(t=>{if(this.drawMode){const{x:s,y:i}=t.pointer,o=s-this.startX,a=i-this.startY;0!=a&&(e.createSquare(this.startX,this.startY,o,a,""),e.modal=!0)}else if(e.move)e.move=!1;else{const{x:e,y:i}=t.pointer,o=e-this.startX,a=i-this.startY;s.scrollLeft=s.scrollLeft+-1*o,s.scrollTop=s.scrollTop+-1*a}})),fabric.Image.fromURL(i,(t=>{t.set({selectable:!1}),e.backgroundImg=t,l.setBackgroundImage(t,(()=>{const i=t.width,o=t.height;l.setWidth(i),l.setHeight(o),e.canvasWidth=i,e.canvasHeight=o,s.style.height=o,s.style.width=i,l.renderAll()}))}))}},mounted(){this.getData()}},n=r,c=s(1001),d=(0,c.Z)(n,i,o,!1,null,null,null),h=d.exports}}]);
//# sourceMappingURL=page-drawMobile.72ce7f72.js.map