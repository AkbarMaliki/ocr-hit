"use strict";(self["webpackChunknew"]=self["webpackChunknew"]||[]).push([[858],{5236:function(t,e,i){i.r(e),i.d(e,{default:function(){return c}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[t.modal?e("div",{staticStyle:{position:"fixed",width:"100vw",height:"100vh",left:"0",top:"0","z-index":"9998"},on:{click:function(e){t.modal=!1}}}):t._e(),t.modal?e("div",{staticStyle:{position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","z-index":"9999","min-width":"80vw"}},[e("div",{staticClass:"rounded-lg shadow p-3 bg-white animate__animated animate__bounceIn"},[e("p",{staticClass:"text-sm font-semibold"},[t._v("List Data ("+t._s(t.item.table)+")")]),e("hr"),t._l(t.boxes,(function(i,o){return e("div",{key:o+"boxes"},[e("p",{staticClass:"m-0 p-0 text-xs"},[t._v("Field : "+t._s(i.field))]),e("p",{staticClass:"m-0 p-0 text-xs"},[t._v("Text : "+t._s(i.text))]),e("hr")])})),e("hr"),e("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"button"},on:{click:t.saveData}},[t._v("Simpan")])],2)]):t._e(),t._m(0),e("div",{staticStyle:{position:"absolute","z-index":"999",top:"0",left:"0"}},t._l(t.scaledBoxes,(function(i,o){return e("div",{key:o,staticClass:"rectangle",style:t.getRectangleStyles(i)})})),0),e("video",{attrs:{id:"video",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),e("div",{staticClass:"row justify-content-center",staticStyle:{position:"fixed",bottom:"20px",left:"0",width:"100vw"}},[e("div",{staticClass:"col-3"},[e("button",{staticClass:"btn btn-lg rounded-circle btn-success text-lg pt-3 pb-2",staticStyle:{"font-size":"20px"},attrs:{id:"captureBtn"},on:{click:t.capture}},[e("i",{staticClass:"text-lg fa fa-camera",staticStyle:{"font-size":"20px"},attrs:{"aria-hidden":"true"}})])])]),e("br"),e("canvas",{staticStyle:{display:"none"},attrs:{id:"canvasElement"}}),e("img",{staticStyle:{display:"none",position:"absolute","z-index":"-1",left:"-10000"},attrs:{id:"photoElement",src:"",alt:"Captured Photo"}}),e("div",{attrs:{id:"cropContainer"}})])},s=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{position:"fixed",top:"0",left:"0","z-index":"9999"}},[e("div",{staticClass:"spinner-container"},[e("div",{staticClass:"spinner"})])])}],a=(i(7658),i(2801),i(1439),i(7585),i(5315),{data(){return{boxes:[],scaledBoxes:[],height:1920,width:1080,item:{},scan:!1,modal:!1,listCropImage:[],listHasil:[]}},layout:"camera",methods:{async saveData(){let t=this;const e=firebase.collection(firebase.firestore,t.item.table);let i={};t.boxes.forEach((t=>{i[t.field]=t.text})),await firebase.addDoc(e,i).then((t=>{console.log("Layouts added with ID: ",t.id)})).catch((t=>{console.error("Error adding Layouts: ",t)})),t.modal=!1,t.$router.push(`/database?table=${t.item.table}&id=${t.$route.query.id}`)},capture(){let t=this;const e=document.getElementById("canvasElement"),i=document.getElementById("photoElement");e.width=video.videoWidth,e.height=video.videoHeight,e.getContext("2d").drawImage(video,0,0,e.width,e.height);const o=e.toDataURL("image/jpeg");i.src=o,setTimeout((()=>{t.cropPhoto()}),1e3)},cropPhoto(){let t=this;console.log("start croping");const e=document.getElementById("photoElement"),i=document.createElement("canvas"),o=i.getContext("2d"),s=new Image;s.onload=()=>{let e=this.boxes.length-1;for(let a=0;a<this.boxes.length;a++){const{x:n,y:l,width:d,height:c}=this.boxes[a];i.width=d,i.height=c,o.drawImage(s,n,l,d,c,0,0,d,c);const r=i.toDataURL(),h=new Image;h.src=r,t.sendToApi(r,a),e==a&&setTimeout((()=>{t.modal=!0}),3e3)}},s.setAttribute("crossorigin","anonymous"),s.src=e.src},async sendToApi(t,e){let i=this;const o="https://hit-ocr.online/api/upload-ocr";function s(t,e){const i=t.split(","),o=i[0].match(/:(.*?);/)[1],s=atob(i[1]);let a=s.length;const n=new Uint8Array(a);while(a--)n[a]=s.charCodeAt(a);return new File([n],e,{type:o})}const a=s(t,`image${e}.jpg`),n=new FormData;n.append("file",a);let l=await axios.post(o,n);i.item.boxes[e]["text"]=l.data.text.join(" ")},getRectangleStyles({x:t,y:e,width:i,height:o}){return{position:"absolute",left:`${t}px`,top:`${e}px`,width:`${i}px`,height:`${o}px`,border:"1px solid red"}},startVideo(){let t=this;const e=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:t.height},height:{ideal:t.width}}}).then((function(i){function o(t,e,i,o,s){const a=o/e,n=s/i,l=t.map((t=>({x:Math.round(t.x*a),y:Math.round(t.y*n),width:Math.round(t.width*a),height:Math.round(t.height*n)})));return l}t.$forceUpdate(),e.srcObject=i,e.play();const s=t.boxes;setTimeout((()=>{const e=document.getElementById("video"),i=t.width,a=t.height,n=e.clientWidth,l=e.clientHeight,d=o(s,i,a,n,l);t.scaledBoxes=d}),3e3)}))},async getData(){let t=this;const e=firebase.doc(firebase.firestore,"ocr-layouts",t.$route.query.id);firebase.getDoc(e).then((e=>{if(e.exists()){let i=e.data();t.item=i,t.height=i.height,t.width=i.width,i.boxes&&(t.boxes=i.boxes),t.imageUrl="https://hit-ocr.online/uploaded/"+i.filename,console.log("Document data:",e.data()),t.startVideo()}else console.log("Document does not exist")})).catch((t=>{console.error("Error getting document:",t)}))}},mounted(){this.getData()}}),n=a,l=i(1001),d=(0,l.Z)(n,o,s,!1,null,null,null),c=d.exports}}]);
//# sourceMappingURL=page-scan.0828cbb3.js.map