"use strict";(self["webpackChunknew"]=self["webpackChunknew"]||[]).push([[858],{3031:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home",staticStyle:{height:"100vh"}},[t.modal?e("div",{staticStyle:{position:"fixed",width:"100vw",height:"100vh",left:"0",top:"0","z-index":"9998"},on:{click:function(e){t.modal=!1}}}):t._e(),t.modal?e("div",{staticStyle:{position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","z-index":"9999","min-width":"80vw"}},[e("div",{staticClass:"rounded-lg shadow p-3 bg-white animate__animated animate__bounceIn"},[e("p",{staticClass:"text-sm font-semibold"},[t._v("List Data ("+t._s(t.item.table)+")")]),e("hr"),t._l(t.listCropImage,(function(t,i){return e("div",{key:i+"listCropImage"},[e("img",{staticStyle:{width:"100px"},attrs:{src:t,alt:""}}),e("br")])})),t._l(t.item.boxes,(function(i,s){return e("div",{key:s+"boxes"},[e("p",{staticClass:"m-0 p-0 text-xs"},[t._v("Field : "),t._v(" "+t._s(i.field)+" ")]),e("table",[e("tr",[e("td",{staticClass:"p-0 m-0 text-xs"},[t._v("Text")]),e("td",{staticClass:"px-2"},[t._v(":")]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.boxes[s]["text"],expression:"boxes[index]['text']"}],staticClass:"d-inline text-xs",staticStyle:{border:"none",width:"100%"},attrs:{type:"text"},domProps:{value:t.boxes[s]["text"]},on:{input:function(e){e.target.composing||t.$set(t.boxes[s],"text",e.target.value)}}})])])]),e("hr")])})),e("hr"),e("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"button"},on:{click:t.saveData}},[t._v("Simpan")])],2)]):t._e(),t._m(0),e("div",{staticStyle:{position:"absolute","z-index":"999",top:"0",left:"0"}},t._l(t.scaledBoxes,(function(i,s){return e("div",{key:s,staticClass:"rectangle",style:t.getRectangleStyles(i)})})),0),e("video",{attrs:{id:"video",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),e("button",{staticClass:"btn btn-lg rounded-circle btn-success text-lg pt-3 pb-2",staticStyle:{"font-size":"20px",position:"fixed",bottom:"20px",right:"44%"},attrs:{id:"captureBtn"},on:{click:t.capture}},[e("i",{staticClass:"text-lg fa fa-camera",staticStyle:{"font-size":"20px"},attrs:{"aria-hidden":"true"}})]),e("br"),e("canvas",{staticStyle:{display:"none"},attrs:{id:"canvasElement"}}),e("img",{staticStyle:{display:"none",position:"absolute","z-index":"-1",left:"-10000"},attrs:{id:"photoElement",src:"",alt:"Captured Photo"}}),e("div",{attrs:{id:"cropContainer"}})])},o=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{position:"fixed",top:"0",left:"0","z-index":"9999"}},[e("div",{staticClass:"spinner-container"},[e("div",{staticClass:"spinner"})])])}],a=(i(7658),i(2801),i(1439),i(7585),i(5315),i(9199));let n=new a.Z;var l={data(){return{boxes:[],scaledBoxes:[],height:1920,width:1080,item:{},scan:!1,modal:!1,listCropImage:[],listHasil:[]}},layout:"camera",methods:{async saveData(){let t=this;const e=firebase.collection(firebase.firestore,t.item.table);let i={};t.boxes.forEach((t=>{i[t.field]=t.text})),await firebase.addDoc(e,i).then((t=>{console.log("Layouts added with ID: ",t.id)})).catch((t=>{console.error("Error adding Layouts: ",t)})),t.modal=!1,t.$router.push(`/database?table=${t.item.table}&id=${t.$route.query.id}`)},capture(){let t=this;n.loadingOn(),t.listCropImage=[];const e=document.getElementById("canvasElement"),i=document.getElementById("photoElement");e.width=video.videoWidth,e.height=video.videoHeight,e.getContext("2d").drawImage(video,0,0,e.width,e.height);const s=e.toDataURL("image/jpeg");i.src=s,setTimeout((()=>{t.cropPhoto()}),1e3)},cropPhoto(){let t=this;console.log("start croping");const e=document.getElementById("photoElement"),i=document.createElement("canvas"),s=i.getContext("2d"),o=new Image;document.getElementById("cropContainer");o.onload=async()=>{let e=this.boxes.length-1;for(let r=0;r<this.boxes.length;r++){var{x:a,y:l,width:d,height:c}=this.boxes[r];i.width=d,i.height=c,a="landscape"==t.item.dimension?a-60:a+90,l="landscape"==t.item.dimension?l+85:l,s.drawImage(o,a,l,d,c,0,0,d,c);const h=i.toDataURL(),m=new Image;m.src=h,t.listCropImage.push(h),await t.sendToApi(h,r),e==r&&(n.loadingOff(),t.modal=!0)}},o.setAttribute("crossorigin","anonymous"),o.src=e.src},async sendToApi(t,e){let i=this;const s="https://hit-ocr.online/api/upload-ocr";function o(t,e){const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=atob(i[1]);let a=o.length;const n=new Uint8Array(a);while(a--)n[a]=o.charCodeAt(a);return new File([n],e,{type:s})}const a=o(t,`image${e}.jpg`),n=new FormData;n.append("file",a);let l=await axios.post(s,n);return console.log("hasil",l),i.item.boxes[e]["text"]=l.data.text.join(" "),i.$forceUpdate(),console.log(i.item.boxes[e]),l},getRectangleStyles({x:t,y:e,width:i,height:s}){return{position:"absolute",left:`${t}px`,top:`${e}px`,width:`${i}px`,height:`${s}px`,border:"1px solid red"}},startVideo(){let t=this;const e=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:"landscape"==t.item.dimension?t.width:t.height},height:{ideal:"landscape"==t.item.dimension?t.height:t.width}}}).then((function(i){function s(t,e,i,s,o){const a=s/e,n=o/i,l=t.map((t=>({x:t.x*a,y:t.y*n,width:t.width*a,height:t.height*n})));return l}t.$forceUpdate(),e.srcObject=i,e.play();const o=t.boxes;setTimeout((()=>{const e=document.getElementById("video"),i="landscape"==t.item.dimension?t.height:t.width,a="landscape"==t.item.dimension?t.width:t.height,l=e.clientWidth,d=e.clientHeight,c=s(o,i,a,l,d);t.scaledBoxes=c,n.alert(`Posisikan Camera ${t.item.dimension}`,"bg-yellow-800")}),2e3)}))},async getData(){let t=this;const e=firebase.doc(firebase.firestore,"ocr-layouts",t.$route.query.id);firebase.getDoc(e).then((e=>{if(e.exists()){let i=e.data();t.item=i,t.height=i.height,t.width=i.width,i.boxes&&(t.boxes=i.boxes),t.imageUrl="https://hit-ocr.online/uploaded/"+i.filename,console.log("Document data:",e.data()),t.startVideo()}else console.log("Document does not exist")})).catch((t=>{console.error("Error getting document:",t)}))}},mounted(){this.getData()}},d=l,c=i(1001),r=(0,c.Z)(d,s,o,!1,null,null,null),h=r.exports}}]);
//# sourceMappingURL=page-scan.2b661965.js.map