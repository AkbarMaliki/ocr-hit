"use strict";(self["webpackChunknew"]=self["webpackChunknew"]||[]).push([[858],{5453:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home",staticStyle:{height:"100vh"}},[t.modal?e("div",{staticStyle:{position:"fixed",width:"100vw",height:"100vh",left:"0",top:"0","z-index":"18"},on:{click:function(e){t.modal=!1}}}):t._e(),t.modal?e("div",{staticStyle:{position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","z-index":"19","min-width":"80vw"}},[e("div",{staticClass:"rounded-lg shadow p-3 bg-white animate__animated animate__bounceIn"},[e("p",{staticClass:"text-sm font-semibold"},[t._v("List Data ("+t._s(t.item.table)+")")]),e("hr"),t._l(t.listCropImage,(function(t,i){return e("div",{key:i+"listCropImage"},[e("img",{directives:[{name:"viewer",rawName:"v-viewer"}],staticStyle:{width:"100px"},attrs:{src:t,alt:""}}),e("br")])})),t._l(t.item.boxes,(function(i,a){return e("div",{key:a+"boxes"},[e("p",{staticClass:"m-0 p-0 text-xs"},[t._v("Field : "),t._v(" "+t._s(i.field)+" ")]),e("table",[e("tr",[e("td",{staticClass:"p-0 m-0 text-xs"},[t._v("Text")]),e("td",{staticClass:"px-2"},[t._v(":")]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.boxes[a]["text"],expression:"boxes[index]['text']"}],staticClass:"d-inline text-xs",staticStyle:{border:"none",width:"100%"},attrs:{type:"text"},domProps:{value:t.boxes[a]["text"]},on:{input:function(e){e.target.composing||t.$set(t.boxes[a],"text",e.target.value)}}})])])]),e("hr")])})),e("hr"),e("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"button"},on:{click:t.saveData}},[t._v("Simpan")])],2)]):t._e(),t._m(0),e("div",{staticStyle:{position:"absolute","z-index":"15",top:"0",left:"0"}},t._l(t.scaledBoxes,(function(i,a){return e("div",{key:a,staticClass:"rectangle",style:t.getRectangleStyles(i)})})),0),e("video",{attrs:{id:"video",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),t.item?e("button",{staticClass:"btn btn-lg rounded-circle btn-success text-lg pt-3 pb-2",staticStyle:{"font-size":"20px",position:"fixed","z-index":"10000"},style:"landscape"==t.item.dimension?"top:20px;left:20px;":"bottom:20px;right:44%;",attrs:{id:"captureBtn"},on:{click:t.capture}},[e("i",{staticClass:"text-lg fa fa-camera",staticStyle:{"font-size":"20px"},attrs:{"aria-hidden":"true"}})]):t._e(),e("br"),e("canvas",{staticStyle:{display:"none"},attrs:{id:"canvasElement"}}),e("img",{staticStyle:{display:"none",position:"absolute","z-index":"-1",left:"-10000"},attrs:{id:"photoElement",src:"",alt:"Captured Photo"}}),e("div",{attrs:{id:"cropContainer"}})])},s=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{position:"fixed",top:"0",left:"0","z-index":"9999"}},[e("div",{staticClass:"spinner-container"},[e("div",{staticClass:"spinner"})])])}],o=(i(7658),i(2801),i(1439),i(7585),i(5315),i(9199));let n=new o.Z;var l={data(){return{boxes:[],scaledBoxes:[],height:1920,width:1080,item:!1,scan:!1,modal:!1,listCropImage:[],listHasil:[]}},layout:"camera",methods:{async saveData(){let t=this;const e=firebase.collection(firebase.firestore,t.item.table);let i={};t.boxes.forEach((t=>{i[t.field]=t.text})),await firebase.addDoc(e,i).then((t=>{console.log("Layouts added with ID: ",t.id)})).catch((t=>{console.error("Error adding Layouts: ",t)})),t.modal=!1,t.$router.push(`/database?table=${t.item.table}&id=${t.$route.query.id}`)},capture(){let t=this;n.loadingOn(),t.listCropImage=[];const e=document.getElementById("canvasElement"),i=document.getElementById("photoElement");e.width=video.videoWidth,e.height=video.videoHeight,e.getContext("2d").drawImage(video,0,0,e.width,e.height);const a=e.toDataURL("image/jpeg");i.src=a,setTimeout((()=>{t.cropPhoto()}),1e3)},cropPhoto(){let t=this;console.log("start croping");const e=document.getElementById("photoElement"),i=document.createElement("canvas"),a=i.getContext("2d"),s=new Image;document.getElementById("cropContainer");const o=100,l=100;s.onload=async()=>{let e=this.boxes.length-1;for(let m=0;m<this.boxes.length;m++){var{x:d,y:c,width:r,height:h}=this.boxes[m];let p=r+2*o,g=h+2*l;i.width=p,i.height=g;let u=o,x=l;"landscape"==t.item.dimension&&(c+=95,d-=80),a.fillStyle="white",a.fillRect(0,0,p,g);const f=a.getImageData(0,0,i.width,i.height),b=f.data,v=100;for(let t=0;t<b.length;t+=4){const e=(b[t]+b[t+1]+b[t+2])/3;e>=v?(b[t]=255,b[t+1]=255,b[t+2]=255):(b[t]=.8*b[t],b[t+1]=.8*b[t+1],b[t+2]=.8*b[t+2])}a.putImageData(f,0,0),a.drawImage(s,d,c,r,h,u,x,r,h);const y=i.toDataURL(),w=new Image;w.src=y,t.listCropImage.push(y),await t.sendToApi(y,m),e==m&&(n.loadingOff(),t.modal=!0)}},s.setAttribute("crossorigin","anonymous"),s.src=e.src},async sendToApi(t,e){let i=this;const a="https://hit-ocr.online/api/upload-ocr";function s(t,e){const i=t.split(","),a=i[0].match(/:(.*?);/)[1],s=atob(i[1]);let o=s.length;const n=new Uint8Array(o);while(o--)n[o]=s.charCodeAt(o);return new File([n],e,{type:a})}const o=s(t,`image${e}.jpg`),n=new FormData;n.append("file",o);let l=await axios.post(a,n);return console.log("hasil",l),i.item.boxes[e]["text"]=l.data.text.join(" "),i.$forceUpdate(),console.log(i.item.boxes[e]),l},getRectangleStyles({x:t,y:e,width:i,height:a}){return{position:"absolute",left:`${t}px`,top:`${e}px`,width:`${i}px`,height:`${a}px`,border:"1px solid red"}},startVideo(){let t=this;const e=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:"landscape"==t.item.dimension?t.width:t.height},height:{ideal:"landscape"==t.item.dimension?t.height:t.width}}}).then((function(i){function a(t,e,i,a,s){const o=a/e,n=s/i,l=t.map((t=>({x:t.x*o,y:t.y*n,width:t.width*o,height:t.height*n})));return l}t.$forceUpdate(),e.srcObject=i,e.play();const s=t.boxes;setTimeout((()=>{const e=document.getElementById("video"),i="landscape"==t.item.dimension?t.height:t.width,o="landscape"==t.item.dimension?t.width:t.height,l=e.clientWidth,d=e.clientHeight,c=a(s,i,o,l,d);t.scaledBoxes=c,n.alert(`Posisikan Camera ${t.item.dimension}`,"bg-yellow-800")}),2e3)}))},async getData(){let t=this;const e=firebase.doc(firebase.firestore,"ocr-layouts",t.$route.query.id);firebase.getDoc(e).then((e=>{if(e.exists()){let i=e.data();t.item=i,t.height=i.height,t.width=i.width,i.boxes&&(t.boxes=i.boxes),t.imageUrl="https://hit-ocr.online/uploaded/"+i.filename,console.log("Document data:",e.data()),t.startVideo()}else console.log("Document does not exist")})).catch((t=>{console.error("Error getting document:",t)}))}},mounted(){this.getData()}},d=l,c=i(1001),r=(0,c.Z)(d,a,s,!1,null,null,null),h=r.exports}}]);
//# sourceMappingURL=page-scan.616241e1.js.map